#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ğŸš€ Neon Pre-Commit Hook
echo "ğŸ”„ Running pre-commit auto-processing..."

# Run linting and auto-fix
echo "ğŸ§¹ Auto-fixing lint issues..."
npm run lint --if-present -- --fix || true

# Format code with Prettier
echo "ğŸ’… Formatting code..."
npx prettier --write . --ignore-unknown || true

# Type checking
echo "ğŸ” Running type checks..."
npm run type-check --if-present || true

# Generate Prisma client if schema changed
if git diff --cached --name-only | grep -q "schema.prisma"; then
    echo "ğŸ—„ï¸ Prisma schema changed, regenerating client..."
    npm run db:generate --if-present || true
fi

# Re-add files that may have been modified by auto-fix
echo "ğŸ“ Re-staging auto-fixed files..."
git add .

echo "âœ… Pre-commit processing complete!" 